# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure(2) do |config|

  # Boot2docker with guest additions to mount shared folders
  config.vm.box = "AlbanMontaigu/boot2docker"

  # Shared folders
  config.vm.synced_folder "../cluster-files/bin", "/mnt/build-outputs"
  config.vm.synced_folder "../cluster-files/ssl", "/mnt/ssl-outputs"
  config.vm.synced_folder "../cluster-files", "/mnt/ssl-config"

  config.vm.provider "virtualbox" do |vb|
     vb.memory = "2048"
     vb.cpus  = "2"
   end

  config.vm.provision "shell", privileged: false, keep_color: true, inline: <<-SHELL
        # Install bash
        tce-load -wi bash
         
        # Replace CR when mounting mounting from windows
        tr -d "\015" < /vagrant/build-cfssl.sh > ~/build-cfssl.sh
        tr -d "\015" < /vagrant/generate-ca.sh > ~/generate-ca.sh
	    
        # do some links
	    ln -s /mnt/ssl-config/ca-config.json ~/ca-config.json 
	    ln -s /mnt/ssl-config/ca-csr.json ~/ca-csr.json 
	    
	    # Make executable
        chmod +x ~/build-cfssl.sh ~/generate-ca.sh
   SHELL
end
